<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Glow Up Analyzer</title>

  <style>
    body {
      font-family: system-ui, Arial;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
      text-align: center;
    }

    .box {
      border: 2px dashed #ccc;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    button {
      background: #b87b6b;
      color: white;
      padding: 12px 22px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 15px;
    }

    #result {
      margin-top: 30px;
      text-align: left;
      line-height: 1.6;
    }

    ul {
      padding-left: 20px;
    }
  </style>
</head>

<body>

<h2>Your Personalized Glow Up Plan üíï</h2>

<div class="box">
  <input type="file" id="imageInput" accept="image/*" />
  <br/>
  <button onclick="upload()">Analyze My Photo</button>
</div>

<div id="result"></div>

<script>
const WORKER_URL = "https://lwfs-glowup.lisa-668.workers.dev";


// =================================================
// SMART PRODUCT MATCHING (based on AI text)
// =================================================
function buildProductLinks(aiText) {

  const products = [];
  const t = aiText.toLowerCase();

  const add = (name, link) => {
    products.push(`<li><a href="${link}" target="_blank">${name}</a></li>`);
  };

  // Makeup
  if (t.includes("foundation") || t.includes("bb cream") || t.includes("coverage")) {
    add("Maybelline Dream Fresh BB Cream", "https://amzn.to/3ZdhexZ");
    add("IT Cosmetics CC+ Cream", "https://amzn.to/4qXIz3A");
  }

  if (t.includes("concealer") || t.includes("under eye")) {
    add("Maybelline Fit Me Concealer", "https://amzn.to/4kaUqIV");
  }

  if (t.includes("blush")) {
    add("e.l.f. Cream Multi Stick (Blush)", "https://amzn.to/4t7NDni");
  }

  if (t.includes("liner") || t.includes("eyeliner")) {
    add("Revlon Soft Brown Eyeliner", "https://amzn.to/3ZI9bJD");
  }

  if (t.includes("mascara") || t.includes("lashes")) {
    add("L‚ÄôOreal Telescopic Mascara", "https://amzn.to/4auXEnb");
  }

  if (t.includes("lip")) {
    add("Revlon Glass Shine Lip Balm", "https://amzn.to/3ZHf2yP");
  }

  // Hair
  if (t.includes("volume") || t.includes("lift") || t.includes("root")) {
    add("Color Wow Root Lift Spray", "https://amzn.to/4kbLbIf");
  }

  if (t.includes("heat") || t.includes("blow")) {
    add("Kenra Heat Protectant Spray", "https://amzn.to/4t5oTMp");
  }

  // Skincare
  if (t.includes("cleanser")) {
    add("CeraVe Hydrating Cleanser", "https://amzn.to/45ElBFX");
  }

  if (t.includes("vitamin c")) {
    add("TruSkin Vitamin C Serum", "https://amzn.to/4aq94so");
  }

  if (t.includes("spf") || t.includes("sunscreen")) {
    add("Aveeno Protect + Hydrate SPF 60", "https://amzn.to/4qebwHg");
  }

  if (products.length === 0) return "";

  return `
    <hr style="margin:40px 0">
    <h3>üõç Helpful Products Based on Your Results</h3>
<p style="font-size:14px;color:#666;">
These are well-reviewed, mature-skin friendly picks that match what your analysis suggested.
</p>

    <ul>
      ${products.join("")}
    </ul>
  `;
}


// =================================================
// MAIN UPLOAD FUNCTION
// =================================================
async function upload() {

  const file = document.getElementById("imageInput").files[0];
  if (!file) return alert("Please upload a photo first");

  const resultDiv = document.getElementById("result");

  resultDiv.innerHTML = "Analyzing your photo‚Ä¶ please wait üíï";

  const formData = new FormData();
  formData.append("image", file);

  try {

    const res = await fetch(WORKER_URL, {
      method: "POST",
      body: formData
    });

    const text = await res.text();

    // Show AI analysis + matched products
    resultDiv.innerHTML = text + buildProductLinks(text);

  } catch (err) {
    resultDiv.innerHTML = "Something went wrong. Please try again.";
  }
}
</script>

</body>
</html>

